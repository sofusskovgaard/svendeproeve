@inject ISessionStore SessionStore
@inherits LayoutComponentBase
@implements IDisposable

@if (SessionStore.Loaded)
{
    <div class="page">
        <div class="sidebar">
            <NavMenu/>
        </div>

        <main>
            <div class="top-row px-4 gap-4">
                <a href="https://docs.microsoft.com/aspnet/" target="_blank">About</a>

                @if (!SessionStore.LoggedIn)
                {
                    <NavLink href="login">Login</NavLink>
                }
                else
                {
                    <button class="btn btn-link" @onclick="() => SessionStore.Logout()">Logout</button>
                    <span>@SessionStore.CurrentUser.Firstname @SessionStore.CurrentUser.Lastname</span>
                }
            </div>

            <article class="content px-4">
                @Body
            </article>
        </main>
    </div>
}
else
{
    <style type="text/css">
        .lds-ripple {
            display: inline-block;
            height: 80px;
            position: relative;
            width: 80px;
        }

        .lds-ripple div {
            animation: lds-ripple 1s cubic-bezier(0, 0.2, 0.8, 1) infinite;
            border: 4px solid #333;
            border-radius: 50%;
            opacity: 1;
            position: absolute;
        }

        .lds-ripple div:nth-child(2) { animation-delay: -0.5s; }

        @@keyframes lds-ripple {
            0% {
                height: 0;
                left: 36px;
                opacity: 0;
                top: 36px;
                width: 0;
            }

            4.9% {
                height: 0;
                left: 36px;
                opacity: 0;
                top: 36px;
                width: 0;
            }

            5% {
                height: 0;
                left: 36px;
                opacity: 1;
                top: 36px;
                width: 0;
            }

            100% {
                height: 72px;
                left: 0px;
                opacity: 0;
                top: 0px;
                width: 72px;
            }
        }
    </style>

    <div style="align-items: center; bottom: 0; display: flex; justify-content: center; left: 0; position: absolute; right: 0; top: 0;">
        <div class="lds-ripple">
            <div></div>
            <div></div>
        </div>
    </div>
}

@code {

    protected override void OnInitialized()
    {
        SessionStore.OnSessionStoreLoaded += StateHasChanged;
        SessionStore.OnSessionChanged += StateHasChanged;
    }

    public void Dispose()
    {
        SessionStore.OnSessionStoreLoaded -= StateHasChanged;
        SessionStore.OnSessionChanged -= StateHasChanged;
    }

}